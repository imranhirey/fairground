# Documentation: Simple Authentication App

This is a simple authentication app built using Node.js, TypeScript, Express, MongoDB, and Handlebars for the front end. It follows the MVC (Model-View-Controller) architecture.

## Features
### User Registration:
- Users can register with a unique username and password.
- Passwords are hashed using bcryptjs.

### User Login:
- Users can log in with their credentials.
- Sessions are managed using express-session.

### User Logout:
- Users can log out, which destroys their session.

### Error Handling:
- Duplicate username errors are handled gracefully.
- Server errors are caught and displayed to the user.

### Docker Support:
- MongoDB is containerized using Docker.

## Technologies Used
### Backend:
- Node.js
- Express
- TypeScript
- MongoDB (with Mongoose)
- bcryptjs (for password hashing)
- express-session (for session management)

### Frontend:
- Handlebars (for templating)
- Bootstrap (for styling)

### Docker:
- MongoDB container

## How to Set Up and Run the App
### 1. Prerequisites
- Install Node.js (v16 or higher).
- Install Docker (if using Docker for MongoDB).
- Install MongoDB (if not using Docker).

### 2. Clone the Repository
```bash
git clone https://github.com/imranhirey/fairground.git
cd fairground
```

### 3. Install Dependencies
```bash
npm install
```

### 4. Set Up Environment Variables
Create a `.env` file in the root directory:
```env
SESSION_SECRET=your-secret-key
MONGO_URI=mongodb://localhost:27017/auth_app
```

### 5. Run MongoDB with Docker
If you want to use Docker for MongoDB, follow these steps:

Create a `docker-compose.yml` file:
```yaml
version: '3.8'
services:
  mongo:
    image: mongo:latest
    container_name: mongo
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
    volumes:
      - mongo-data:/data/db

volumes:
  mongo-data:
```

Start the MongoDB container:
```bash
docker-compose up -d
```

Verify the container is running:
```bash
docker ps
```

Stop the container (when needed):
```bash
docker-compose down
```

### 6. Run the App
#### Development Mode:
```bash
npm run dev
```

#### Production Mode:
```bash
npm run build
npm start
```

Access the app at: `http://localhost:3000`.

## Running Tests
The application includes unit tests to ensure the authentication flow is working correctly.

### 1. Test Structure
- **Controller Tests**: Located in `src/__tests__/controllers/authController.test.ts`.
- **Route Tests**: Located in `src/__tests__/routes/authRoutes.test.ts`.
- **Utility Tests**: Located in `src/__tests__/utils/testUtils.ts`.

### 2. Running Tests
To run all tests, use the following command:
```bash
npm test
```

For running tests in watch mode (useful during development):
```bash
npm run test:watch
```

### 3. Testing Frameworks Used
- **Jest**: The main testing framework.
- **Supertest**: Used for testing HTTP requests.
- **Mocking Libraries**: Jestâ€™s built-in mocking capabilities for simulating database interactions.

## Folder Structure
```
simple_auth/
â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ authRoutes.js
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.ts
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ session.d.ts
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ docs.handlebars
â”‚   â”‚   â”œâ”€â”€ home.handlebars
â”‚   â”‚   â”œâ”€â”€ login.handlebars
â”‚   â”‚   â”œâ”€â”€ register.handlebars
â”‚   â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.handlebars
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ authController.test.ts
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ authRoutes.test.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ testUtils.ts
```

## Troubleshooting
### 1. MongoDB Connection Issues
- Ensure MongoDB is running (either locally or in Docker).
- Check the `MONGO_URI` in `.env`.

### 2. TypeScript Errors
- Ensure all TypeScript dependencies are installed:
```bash
npm install --save-dev typescript @types/node @types/express
```

### 3. Session Issues
- Ensure the `SESSION_SECRET` in `.env` is set.

## Future Improvements
- **Email Verification**: Send a verification email after registration.
- **Password Reset**: Allow users to reset their password via email.
- **Real-Time Username Check**: Use AJAX to check username availability during registration.
- **Unit Tests**: Add tests using Jest or Mocha.

## Conclusion
This app provides a simple and clean implementation of user authentication. Itâ€™s easy to set up, extend, and deploy. With Docker, you can ensure a consistent development environment.

Let me know if you need further assistance or enhancements! ðŸš€
